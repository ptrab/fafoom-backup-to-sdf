= Code Snippets

Some minor code snippets that I find useful and might be helpful for others too.

== Gnuplot

.Gnuplot 5.2 input line to plot the first ten excited states from an ORCA 5.0.3 TDDFT-Scan for a multi XYZ file
[source]
--
nStates=10
gnuplot> plot for [i=0:nStates-1] "< grep 'STATE.*:' s2.out" every nStates::i using 4 with lp title sprintf("S_{%i}", i+1)
--

image::images/gnuplot_of_scan.png[]

== VIM

.Finding all references from a text document written as [1], [1-2], [1,2-3], [1-2,3] and so on and copies them into t
[source]
--
:let t=[] | %s/\[\(\d\+\(-\d\+\)\?,\?\)\+\]/\=add(t,submatch(1))[1:0]/g
--

When the document has been searched, the contents of `t` can be printed with `:pu=t`

== Gaussian

== Errors that tell nothing clear

I encountered the error `Internal consistency failure #1 in ROv06.`
This error means that there is a problem with the Overlay 6 from the IOps: https://gaussian.com/overlay6/
By looking at what is handled by overlay 6, it is clear that the error has something to do with my population analysis keyword.
In my case, it was the combination of nboread and npa together as `pop=(nobread,npa)` which does not work.
`nboread` means that all keywords are redirected to the `$NBO $END` section beneath the coordinates, where `NPA` would be placed then.

== Reading the output

When checking the frequency calculation for the first normal mode, search for `normal co`.
When checking for excited states, search for `Excited State` and you will find the first.

== Adding weights to the TD-DFT output

.Taking a TD-DFT output file from Gaussian, vertical.log, and use awk to add weights to the MO pairs that are above 8% weight (`2*$4*$4 >= 0.08`) for a closed shell calculation
[source]
--
grep 'Excited State\|->\|<-' vertical.log | sed 's/://g' |awk '{if ($1 != "Excited" && 2*$4*$4 >= 0.08) print $1," -> ",$3,"   ", 200*$4*$4; else if ($1 == "Excited") print $0}'
--

.The same as above but specifying hole orbitals to be MO Nr 205 to 207 and electron orbitals to be (210, 211, 213--215) to find specific excitations
[source]
--
grep 'Excited State\|->\|<-' vertical.log | sed 's/://g' |awk '{if ($1 != "Excited" && 2*$4*$4 >= 0.08 && ($1 == 205 || $1 == 206 || $1 == 207) && ($3 == 210 || $3 == 211 || $3 == 213 || $3 == 214 || $3 == 215)) print $1, $2, $3, "   ", 200*$4*$4; else if ($1 == "Excited") print $0}'
--
